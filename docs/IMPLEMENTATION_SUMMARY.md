# ุณุณุชู ุงุญุฑุงุฒ ููุช ุจุง OTP ุชููู ููุฑุงู

## ุฎูุงุตู ูพุงุฏูโุณุงุฒ

ุณุณุชู ุงุญุฑุงุฒ ููุช ุจุง ูุงุจูุชโูุง ุฒุฑ ุจุง ููููุช ูพุงุฏูโุณุงุฒ ุดุฏ:

### โ ูุงุจูุชโูุง ุงุตู

#### 1. ูุฑูุฏ ุจุง ุดูุงุฑู ููุฑุงู ู OTP (ูุฏุฑุ ูุนูู ู ุงููุง)

- ุงุฑุณุงู ฺฉุฏ 6 ุฑูู ุจู ุดูุงุฑู ููุฑุงู
- ุงุนุชุจุงุฑ 5 ุฏูููโุง ุจุฑุง ฺฉุฏ OTP
- ุญุฏุงฺฉุซุฑ 3 ุชูุงุด ุจุฑุง ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ
- ุดูุงุฑุด ูุนฺฉูุณ 2 ุฏูููโุง ุจุฑุง ุงุฑุณุงู ูุฌุฏุฏ
- ูพุดุชุจุงู ุงุฒ ุณุฑูุณโูุง ูพุงูฺฉ ุงุฑุงู:
  - ฺฉุงูู ูฺฏุงุฑ (Kavenegar) โ
  - ูุฑุงุฒ ุงุณโุงูโุงุณ (IPPanel) โ
  - ููโูพุงูฺฉ (Melipayamak) โ

#### 2. ูุฑูุฏ ุจุง ฺฉุฏ ูู (ุฏุงูุดโุขููุฒุงู)

- ูุฑูุฏ ุจุง ฺฉุฏ ูู 10 ุฑูู
- ุฑูุฒ ุนุจูุฑ ุฑูุฒูฺฏุงุฑ ุดุฏู ุจุง bcrypt
- ุงุนุชุจุงุฑุณูุฌ ูุฑูุช ฺฉุฏ ูู

#### 3. ูุฑูุฏ ุจุง ุงูู (ูุฏุฑุงู/ูุฏู)

- ูฺฏูุฏุงุฑ ุณุณุชู ูุจู ุจุฑุง ูุฏุฑุงู
- ููฺฉ ูุฑุงููุด ุฑูุฒ ุนุจูุฑ

### ๐ ูุงูโูุง ุงุฌุงุฏ ุดุฏู

#### Backend

1. **`src/lib/smsService.ts`** - ุณุฑูุณ ุงุฑุณุงู ูพุงูฺฉ

   - ูพุดุชุจุงู ุงุฒ 3 ุณุฑูุณโุฏููุฏู ูพุงูฺฉ ุงุฑุงู
   - ุญุงูุช ุชูุณุนู (Development Mode)
   - ุงุนุชุจุงุฑุณูุฌ ุดูุงุฑู ุชููู
   - ูุฑูุงูโุณุงุฒ ูุฑูุช ุดูุงุฑู

2. **`src/lib/auth.ts`** (ุจูโุฑูุฒุฑุณุงู)

   - `sendOTPToPhone()` - ุชููุฏ ู ุงุฑุณุงู OTP
   - `verifyOTPAndSignIn()` - ุชุงุฏ OTP ู ูุฑูุฏ
   - `signInWithNationalID()` - ูุฑูุฏ ุจุง ฺฉุฏ ูู

3. **`src/lib/database.ts`** (ุจูโุฑูุฒุฑุณุงู)
   - ุงูุฒูุฏู ุณุชูู `phone` ุจู ุฌุฏูู users
   - ุฌุฏูู ุฌุฏุฏ `otp_tokens`
   - ุงูุฏฺฉุณโูุง ุจูููโุณุงุฒ ุดุฏู

#### API Endpoints

4. **`src/app/api/auth/send-otp/route.ts`** - ุงุฑุณุงู OTP
5. **`src/app/api/auth/verify-otp/route.ts`** - ุชุงุฏ OTP
6. **`src/app/api/auth/signin-national-id/route.ts`** - ูุฑูุฏ ุจุง ฺฉุฏ ูู

#### Frontend

7. **`src/app/(auth)/signin/page.tsx`** (ุจุงุฒููุณ ฺฉุงูู)
   - ุฑุงุจุท ฺฉุงุฑุจุฑ 3 ุชุจ
   - ูุฑู ุงุฑุณุงู OTP
   - ูุฑู ุชุงุฏ OTP ุจุง ุดูุงุฑุด ูุนฺฉูุณ
   - ูุฑู ูุฑูุฏ ุจุง ฺฉุฏ ูู
   - ูุฑู ูุฑูุฏ ุจุง ุงูู
   - ูพุดุชุจุงู ุงุฒ ุชู ุชุงุฑฺฉ/ุฑูุดู
   - ุทุฑุงุญ ูุงฺฉูุดโฺฏุฑุง (Responsive)

#### Documentation

8. **`AUTHENTICATION.md`** - ูุณุชูุฏุงุช ฺฉุงูู ุณุณุชู
9. **`TESTING.md`** - ุฑุงูููุง ุชุณุช ู ุขุฒูุงุด
10. **`.env.example`** - ููููู ุชูุธูุงุช ูุญุท

### ๐๏ธ ุชุบุฑุงุช ุฏุชุงุจุณ

```sql
-- ุงูุฒูุฏู ุณุชูู ุชููู
ALTER TABLE users ADD COLUMN phone VARCHAR(20) UNIQUE;

-- ุงุฎุชุงุฑ ฺฉุฑุฏู ุงูู ู ุฑูุฒ ุนุจูุฑ
ALTER TABLE users ALTER COLUMN email DROP NOT NULL;
ALTER TABLE users ALTER COLUMN password_hash DROP NOT NULL;

-- ุฌุฏูู ุชูฺฉูโูุง OTP
CREATE TABLE otp_tokens (
  id UUID PRIMARY KEY,
  phone VARCHAR(20) NOT NULL,
  otp_code VARCHAR(6) NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  verified BOOLEAN DEFAULT FALSE,
  attempts INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ุงูุฏฺฉุณโูุง ุจูููโุณุงุฒ
CREATE INDEX idx_users_phone ON users (phone);
CREATE INDEX idx_users_national_id ON users (national_id);
CREATE INDEX idx_otp_tokens_phone_verified ON otp_tokens (phone, verified);
```

### ๐ง ูุญูู ุฑุงูโุงูุฏุงุฒ

#### ุญุงูุช ุชูุณุนู (Development)

```bash
# 1. ูุตุจ ูพฺฉุฌโูุง
npm install

# 2. ุงุฌุฑุง ุณุฑูุฑ
npm run dev

# 3. ุฑูุชู ุจู ุตูุญู ูุฑูุฏ
# http://localhost:3000/signin

# 4. ฺฉุฏ OTP ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ:
# ๐ฑ SMS not configured. OTP code: 123456
```

#### ุญุงูุช ุชููุฏ (Production)

```env
# .env.local
SMS_PROVIDER=kavenegar
SMS_API_KEY=your_api_key_here
SMS_SENDER=10008663
```

### ๐งช ุชุณุช ุณุณุชู

#### 1. ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุชุณุช ุจุง ุดูุงุฑู ุชููู

```sql
INSERT INTO users (phone, name, role, school_id, is_active)
VALUES ('09123456789', 'ูุนูู ุชุณุช', 'teacher', 'school_id_here', true);
```

#### 2. ุชุณุช ุฌุฑุงู OTP

1. ุฑูุชู ุจู ุตูุญู ูุฑูุฏ
2. ฺฉูฺฉ ุฑู ุชุจ "๐ฑ ูุนูู / ูู"
3. ูุงุฑุฏ ฺฉุฑุฏู: `09123456789`
4. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ฺฉุฏ ุชุงุฏ"
5. ุฏุฑุงูุช ฺฉุฏ ุงุฒ ฺฉูุณูู
6. ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ 6 ุฑูู
7. ูุฑูุฏ ูููู โ

#### 3. ุชุณุช ูุฑูุฏ ุจุง ฺฉุฏ ูู

```sql
INSERT INTO users (national_id, password_hash, name, role, school_id, is_active)
VALUES ('1234567890', '$2a$12$hashed_password', 'ุฏุงูุดโุขููุฒ ุชุณุช', 'student', 'school_id_here', true);
```

### ๐ฑ ุณุฑูุณโุฏููุฏฺฏุงู ูพุงูฺฉ ูพุดุชุจุงู ุดุฏู

#### ฺฉุงูู ูฺฏุงุฑ (ุชูุตู ูโุดูุฏ)

- ูุจโุณุงุช: https://panel.kavenegar.com
- ุซุจุชโูุงู ู ุฏุฑุงูุช API Key
- ููุช ููุงุณุจ ู ุณุฑุนุช ุจุงูุง

#### ูุฑุงุฒ ุงุณโุงูโุงุณ (IPPanel)

- ูุจโุณุงุช: https://ippanel.com
- ูพูู ุณุงุฏู ู ฺฉุงุฑุจุฑูพุณูุฏ
- ูุงุจูุช ุงุฑุณุงู ุงูุจูู

#### ููโูพุงูฺฉ

- ูุจโุณุงุช: https://panel.payamak-panel.com
- ูุงุฒููุฏ username/password
- ุณุงุจูู ุทููุงู ุฏุฑ ุงุฑุงู

### ๐ ุงููุช

#### ฺฉุฏ OTP

- โ ุชููุฏ ุชุตุงุฏู ุงูู
- โ ุงููุถุง ุจุนุฏ ุงุฒ 5 ุฏููู
- โ ุญุฏุงฺฉุซุฑ 3 ุชูุงุด
- โ ฺฉุจุงุฑ ูุตุฑู
- โ ุฐุฎุฑู ุงูู ุฏุฑ ุฏุชุงุจุณ

#### ุฑูุฒ ุนุจูุฑ

- โ ูุด bcrypt ุจุง 12 ุฑุงูุฏ
- โ ููุงุณู ุจุง ุฒูุงู ุซุงุจุช
- โ ุงุนุชุจุงุฑุณูุฌ ูู

### ๐ ุฌุฑุงู ฺฉุงุฑุจุฑ

```
ูุฏุฑ/ูุนูู/ูู (Phone OTP):
โโโโโโโโโโโโโโโ
โ ูุฑูุฏ ุดูุงุฑู โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ ุงุฑุณุงู OTP  โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ ุฏุฑุงูุช SMS โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ ูุฑูุฏ ฺฉุฏ    โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ   ูุฑูุฏ โ   โ
โโโโโโโโโโโโโโโ

ุฏุงูุดโุขููุฒ (National ID):
โโโโโโโโโโโโโโโโ
โ ูุฑูุฏ ฺฉุฏ ูู โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโ
โ ูุฑูุฏ ุฑูุฒ    โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโ
โ   ูุฑูุฏ โ    โ
โโโโโโโโโโโโโโโโ
```

### ๐จ ุฑุงุจุท ฺฉุงุฑุจุฑ

#### ูฺฺฏโูุง

- โ ุทุฑุงุญ ูุฏุฑู ู ุฒุจุง
- โ ุชู ุชุงุฑฺฉ/ุฑูุดู
- โ ูุงฺฉูุดโฺฏุฑุง (ููุจุงูุ ุชุจูุชุ ุฏุณฺฉุชุงูพ)
- โ ุงููุดูโูุง ุฑูุงู
- โ ุงุนุชุจุงุฑุณูุฌ ูุญุธูโุง
- โ ูพุงูโูุง ุฎุทุง ุจู ูุงุฑุณ
- โ ุขฺฉููโูุง ูุงุถุญ ุจุฑุง ูุฑ ุฑูุด ูุฑูุฏ
- โ ุดูุงุฑุด ูุนฺฉูุณ ุจุตุฑ

### ๐ ุจูุจูุฏูุง ุขูุฏู

1. **ุซุจุชโูุงู ุฎูุฏฺฉุงุฑ**: ุงุฌุงุฏ ุญุณุงุจ ุจุง OTP ุจุฑุง ฺฉุงุฑุจุฑุงู ุฌุฏุฏ
2. **ุงุญุฑุงุฒ ููุช ุฏู ุนุงูู**: ุชุฑฺฉุจ ุดูุงุฑู + ุฑูุฒ ุนุจูุฑ
3. **ุงูฺฏููุง ูพุงูฺฉ**: ุณูุงุฑุดโุณุงุฒ ูพุงูโูุง ุจุฑุง ูุฑ ูุฏุฑุณู
4. **ูุญุฏูุฏุช ูุฑุฎ**: ุฌููฺฏุฑ ุงุฒ ุณูุกุงุณุชูุงุฏู
5. **ุชุงุฏ ุดูุงุฑู**: ุชุงุฏ ูุงูฺฉุช ุดูุงุฑู ูุจู ุงุฒ ุซุจุชโูุงู
6. **ฺฉุฏูุง ุจุงุฒุงุจ**: ุจุงุฒุงุจ ุฏุฑ ุตูุฑุช ฺฏู ุดุฏู ุชููู
7. **ูุฏุฑุช ูุดุณุช**: JWT ุจูุชุฑ
8. **ูุงฺฏโฺฏุฑ**: ุซุจุช ุชูุงู ุชูุงุดโูุง ูุฑูุฏ

### ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:

1. ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ
2. ุจุฑุฑุณ ฺฉูุณูู ูุฑูุฑฺฏุฑ
3. ุจุฑุฑุณ ูุชุบุฑูุง ูุญุท
4. ูุดุงูุฏู `TESTING.md` ุจุฑุง ุฑุงูููุง ฺฉุงูู
5. ูุดุงูุฏู `AUTHENTICATION.md` ุจุฑุง ุฌุฒุฆุงุช ูู

### ๐ ุงุฏุฏุงุดุชโูุง ููู

- **ุญุงูุช ุชูุณุนู**: ุจุฏูู ูุงุฒ ุจู SMSุ ฺฉุฏ OTP ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ
- **ูุฑูุช ุดูุงุฑู**: ููุท 09XXXXXXXXX (11 ุฑูู) ูพุฐุฑูุชู ูโุดูุฏ
- **ูุฑูุช ฺฉุฏ ูู**: ููุท 10 ุฑูู ูพุฐุฑูุชู ูโุดูุฏ
- **ููุงุฌุฑุช ุฏุชุงุจุณ**: ุฎูุฏฺฉุงุฑ ุฏุฑ ุงููู ุงุฌุฑุง ุงูุฌุงู ูโุดูุฏ

### โจ ูุชุฌู

ุณุณุชู ุงุญุฑุงุฒ ููุช ฺฉุงูู ุจุง ูุงุจูุชโูุง ุฒุฑ ูพุงุฏูโุณุงุฒ ุดุฏ:

- โ ูุฑูุฏ ูุฏุฑุงูุ ูุนููุงู ู ุงููุง ุจุง OTP
- โ ูุฑูุฏ ุฏุงูุดโุขููุฒุงู ุจุง ฺฉุฏ ูู
- โ ูฺฏูุฏุงุฑ ุณุณุชู ูุจู (ุงูู)
- โ ุฑุงุจุท ฺฉุงุฑุจุฑ ูุฏุฑู ู ฺฉุงุฑุจุฑูพุณูุฏ
- โ ูพุดุชุจุงู ุงุฒ ุณุฑูุณโูุง ูพุงูฺฉ ุงุฑุงู
- โ ุงููุช ุจุงูุง
- โ ูุณุชูุฏุงุช ฺฉุงูู

ุณุณุชู ุขูุงุฏู ุงุณุชูุงุฏู ู ุชุณุช ุงุณุช! ๐
