# ุฑุงูููุง ุณุณุชู ฺุช ููุด ูุตููุน ุจุง Markdown ู Streaming

ุงู ูุณุชูุฏ ุชูุถุญ ูโุฏูุฏ ฺฉู ฺฺฏููู ุณุณุชู ฺุช ููุด ูุตููุน ุจุง ูุงุจูุช **ููุงุด ูุงุฑฺฉโุฏุงูู** ู **ููุดุชู ุชุฏุฑุฌ (Streaming)** ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช.

---

## ๐ฏ ูฺฺฏโูุง ุงุตู

โ **ูพุงุณุฎโูุง ูุงุฑฺฉโุฏุงูู ุดุฏู** - ุจุง ูุฑูุชโุจูุฏ ุฒุจุง ุดุงูู:
- ุนูุงูู (H1, H2, H3, H4)
- ุฌุฏุงูู
- ูุณุชโูุง ุดูุงุฑูโุฏุงุฑ ู ููุทูโุง
- ฺฉุฏูุง ู Syntax Highlighting
- ููู ูููโูุง (Blockquotes)
- ูุชู ูพุฑุฑูฺฏ ู ููุฑุจ
- ููฺฉโูุง

โ **ููุดุชู ุชุฏุฑุฌ (Streaming)** - ููุงุด ุฒูุฏู ูพุงุณุฎ ฺฉููู ุจู ฺฉููู
โ **ูพุดุชุจุงู ุงุฒ ุชูุงู ููุดโูุง** - ูุนููุ ุฏุงูุดโุขููุฒุ ูุงูุฏุ ูุฏุฑ
โ **ุฑุงุจุท ฺฉุงุฑุจุฑ ุฌุฐุงุจ** - ุทุฑุงุญ ูุฏุฑู ู ุฑุณูพุงูุณู

---

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง

### 1. **ูพุฑุงููพุชโูุง ุณุณุชู**
๐ `src/lib/aiPrompts.ts`

ุงู ูุงู ุดุงูู ูพุฑุงููพุชโูุง ุงุฎุชุตุงุต ุจุฑุง ูุฑ ููุด ุงุณุช ฺฉู ุจู AI ุฏุณุชูุฑ ูโุฏูุฏ ูพุงุณุฎ ุฑุง ุจู ุตูุฑุช Markdown ุชููุฏ ฺฉูุฏ.

```typescript
teacher: {
  systemPrompt: `...
  **ููู:** ูพุงุณุฎโูุง ุฎูุฏ ุฑุง ุจู ุฒุจุงู ูุงุฑุณ ู ุจุง ูุฑูุช Markdown ุงุฑุงุฆู ุฏูุฏ:
  - ุงุฒ # ุจุฑุง ุนูุงูู ุงุตู
  - ุงุฒ ## ุจุฑุง ุฒุฑุนูุงูุงูโูุง
  - ุงุฒ ุฌุฏุงูู ุจุฑุง ููุงุณูโูุง
  ...`
}
```

### 2. **ุณุฑูุณ AI ุจุง Streaming**
๐ `src/lib/aiService.ts`

ุชุงุจุน `sendChatToOpenAIStream()` ูพุงุณุฎ OpenAI ุฑุง ุจู ุตูุฑุช stream ุฏุฑุงูุช ูโฺฉูุฏ:

```typescript
export async function sendChatToOpenAIStream(
  messages: ChatMessage[],
  role: UserRole
): Promise<ReadableStream>
```

### 3. **API Route ุจุง Streaming**
๐ `src/app/api/ai-chat/route.ts`

ุงู endpoint ูพุงุณุฎ ุฑุง ุจู ุตูุฑุช stream ุจู ฺฉูุงูุช ุงุฑุณุงู ูโฺฉูุฏ:

```typescript
const stream = await sendChatToOpenAIStream(chatMessages, aiRole);

return new NextResponse(stream, {
  headers: {
    "Content-Type": "text/event-stream",
    "Cache-Control": "no-cache",
    Connection: "keep-alive",
  },
});
```

### 4. **Hook ูุฏุฑุช ฺุช**
๐ `src/app/components/AIChat/hooks/useChat.ts`

ุงู hook streaming ุฑุง ูุฏุฑุช ูโฺฉูุฏ ู ูพุงู ุฑุง ฺฉููู ุจู ฺฉููู ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ:

```typescript
const reader = response.body?.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value, { stream: true });
  accumulatedContent += chunk;

  updateMessageContent(chatId, messageId, accumulatedContent);
}
```

### 5. **ฺฉุงููพูููุช ููุงุด ูพุงูโูุง**
๐ `src/app/components/AIChat/ChatMessages.tsx`

ุงู ฺฉุงููพูููุช Markdown ุฑุง render ูโฺฉูุฏ ุจุง ุงุณุชุงูโูุง ุฒุจุง:

```typescript
<ReactMarkdown
  remarkPlugins={[remarkGfm]}
  rehypePlugins={[rehypeHighlight]}
  components={{
    h1: ({ node, ...props }) => (
      <h1 className="text-2xl font-bold mb-4 text-indigo-700" {...props} />
    ),
    table: ({ node, ...props }) => (
      <table className="min-w-full divide-y border rounded-lg" {...props} />
    ),
    // ... ุณุงุฑ ุงููุงูโูุง
  }}
>
  {content}
</ReactMarkdown>
```

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ูุนููุงู:
```
http://localhost:4000/dashboard/teacher/ai-communication
```

### ุจุฑุง ุฏุงูุดโุขููุฒุงู:
```
http://localhost:4000/dashboard/student/ai-communication
```

### ุจุฑุง ูุงูุฏู:
```
http://localhost:4000/dashboard/parent/ai-communication
```

### ุจุฑุง ูุฏุฑุงู:
```
http://localhost:4000/dashboard/principal/ai-communication
```

---

## ๐จ ููููู ูพุงุณุฎโูุง AI

### ูุซุงู 1: ูพุงุณุฎ ุจุง ุนููุงู ู ูุณุช

**ุณูุงู ฺฉุงุฑุจุฑ:**
> ฺฺฏููู ูโุชูุงูู ฺฉูุงุณ ุฑุง ุจูุชุฑ ูุฏุฑุช ฺฉููุ

**ูพุงุณุฎ AI (Markdown):**
```markdown
# ูุฏุฑุช ููุซุฑ ฺฉูุงุณ ุฏุฑุณ

## ุงุตูู ุงุณุงุณ

1. **ููุงูู ูุงุถุญ** - ููุงูู ุฑุง ุงุฒ ุงุจุชุฏุง ุชุนุฑู ฺฉูุฏ
2. **ุซุจุงุช ุฏุฑ ุงุฌุฑุง** - ููุดู ุจู ููุงูู ูพุงุจูุฏ ุจุงุดุฏ
3. **ุชุดูู ูุซุจุช** - ุฑูุชุงุฑูุง ุฎูุจ ุฑุง ุชููุช ฺฉูุฏ

## ุฌุฏูู ุฑูุดโูุง

| ุฑูุด | ูุฒุงุง | ูุนุงุจ |
|-----|-------|-------|
| ุชุดูู ูุซุจุช | ุงูุฒุงุด ุงูฺฏุฒู | ุฒูุงูโุจุฑ |
| ููุงูู ุณุฎุช | ูุธู ุณุฑุน | ฺฉุงูุด ุฎูุงูุช |

> **ูฺฉุชู ููู:** ุชุฑฺฉุจ ุฑูุดโูุง ุจูุชุฑู ูุชุฌู ุฑุง ุฏุงุฑุฏ.
```

**ููุงุด ุฏุฑ UI:**

# ูุฏุฑุช ููุซุฑ ฺฉูุงุณ ุฏุฑุณ

## ุงุตูู ุงุณุงุณ

1. **ููุงูู ูุงุถุญ** - ููุงูู ุฑุง ุงุฒ ุงุจุชุฏุง ุชุนุฑู ฺฉูุฏ
2. **ุซุจุงุช ุฏุฑ ุงุฌุฑุง** - ููุดู ุจู ููุงูู ูพุงุจูุฏ ุจุงุดุฏ
3. **ุชุดูู ูุซุจุช** - ุฑูุชุงุฑูุง ุฎูุจ ุฑุง ุชููุช ฺฉูุฏ

## ุฌุฏูู ุฑูุดโูุง

| ุฑูุด | ูุฒุงุง | ูุนุงุจ |
|-----|-------|-------|
| ุชุดูู ูุซุจุช | ุงูุฒุงุด ุงูฺฏุฒู | ุฒูุงูโุจุฑ |
| ููุงูู ุณุฎุช | ูุธู ุณุฑุน | ฺฉุงูุด ุฎูุงูุช |

> **ูฺฉุชู ููู:** ุชุฑฺฉุจ ุฑูุดโูุง ุจูุชุฑู ูุชุฌู ุฑุง ุฏุงุฑุฏ.

---

### ูุซุงู 2: ูพุงุณุฎ ุจุง ฺฉุฏ

**ุณูุงู ฺฉุงุฑุจุฑ:**
> ฺฉ ูุฑููู ุฑุงุถ ุจุฑุง ูุญุงุณุจู ุณุฑุนุช ุจุฏู

**ูพุงุณุฎ AI:**
```markdown
## ูุฑููู ูุญุงุณุจู ุณุฑุนุช

ูุฑููู ุงุตู:

`ุณุฑุนุช = ูุณุงูุช รท ุฒูุงู`

ุง ุจู ุตูุฑุช ุนูู:

`v = s / t`

### ูุซุงู ุนูู:
- ูุณุงูุช: `100 ูุชุฑ`
- ุฒูุงู: `10 ุซุงูู`
- ุณุฑุนุช: `100 รท 10 = 10 ูุชุฑ ุจุฑ ุซุงูู`
```

---

## โ๏ธ ุชูุธูุงุช

### ุชุบุฑ ูุญูู ููุงุด Markdown

ูุงู `ChatMessages.tsx` ุฑุง ูุฑุงุด ฺฉูุฏ:

```typescript
// ุชุบุฑ ุฑูฺฏ ุนูุงูู
h1: ({ node, ...props }) => (
  <h1 className="text-2xl font-bold text-purple-700" {...props} />
),

// ุชุบุฑ ุงุณุชุงู ุฌุฏุงูู
table: ({ node, ...props }) => (
  <table className="border-2 border-blue-500" {...props} />
),
```

### ุชุบุฑ ุณุฑุนุช Streaming

ุฏุฑ `useChat.ts`:

```typescript
// ุณุฑุนุช ุจุงูุงุชุฑ (ฺุงูฺฉโูุง ุจุฒุฑฺฏุชุฑ)
const chunk = decoder.decode(value, { stream: true });

// ุง ุจุฑุง ฺฉูุชุฑู ุจุดุชุฑ:
await new Promise(resolve => setTimeout(resolve, 10)); // ุชุงุฎุฑ 10ms
```

### ุชุบุฑ ูพุฑุงููพุชโูุง

ูุงู `aiPrompts.ts` ุฑุง ูุฑุงุด ฺฉูุฏ:

```typescript
teacher: {
  systemPrompt: `
    ... ุฏุณุชูุฑุงุช ุฎูุฏ ุฑุง ุงูุฌุง ุจููุณุฏ ...

    **ููู:** ุงุฒ ูุฑูุช Markdown ุงุณุชูุงุฏู ฺฉูุฏ
  `,
  model: "gpt-4-turbo-preview",
  temperature: 0.7,
  maxTokens: 2000,
}
```

---

## ๐จ ุงุณุชุงูโูุง Markdown

### ุนูุงูู
```markdown
# ุนููุงู ุณุทุญ 1 - ุงุตู
## ุนููุงู ุณุทุญ 2 - ุฒุฑุนููุงู
### ุนููุงู ุณุทุญ 3 - ุจุฎุด
```

### ูุณุชโูุง
```markdown
1. ุขุชู ุงูู
2. ุขุชู ุฏูู
   - ุฒุฑ ุขุชู
   - ุฒุฑ ุขุชู

- ุขุชู ููุทูโุง
* ุขุชู ุฏฺฏุฑ
```

### ุฌุฏุงูู
```markdown
| ุณุชูู 1 | ุณุชูู 2 | ุณุชูู 3 |
|--------|--------|--------|
| ุฏุงุฏู 1 | ุฏุงุฏู 2 | ุฏุงุฏู 3 |
| ุฏุงุฏู 4 | ุฏุงุฏู 5 | ุฏุงุฏู 6 |
```

### ฺฉุฏูุง
```markdown
ฺฉุฏ inline: `console.log("Hello")`

```javascript
// ฺฉุฏ ุจูุงฺฉ
function hello() {
  console.log("Hello World");
}
```
```

### ุชุงฺฉุฏ
```markdown
**ูุชู ูพุฑุฑูฺฏ**
*ูุชู ููุฑุจ*
***ูพุฑุฑูฺฏ ู ููุฑุจ***
```

### ููู ููู
```markdown
> ุงู ฺฉ ููู ููู ุงุณุช
> ูโุชูุงูุฏ ฺูุฏ ุฎุท ุจุงุดุฏ
```

### ููฺฉโูุง
```markdown
[ูุชู ููฺฉ](https://example.com)
```

---

## ๐ ุฑูุน ูุดฺฉูุงุช

### ูุดฺฉู: Markdown render ููโุดูุฏ

**ุฑุงูโุญู:**
1. ูุทูุฆู ุดูุฏ `react-markdown` ูุตุจ ุงุณุช:
```bash
npm install react-markdown remark-gfm rehype-highlight
```

2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู imports ุฏุฑุณุช ุจุงุดูุฏ:
```typescript
import ReactMarkdown from "react-markdown";
import remarkGfm from "remark-gfm";
import rehypeHighlight from "rehype-highlight";
```

### ูุดฺฉู: Streaming ฺฉุงุฑ ููโฺฉูุฏ

**ุฑุงูโุญู:**
1. ูุทูุฆู ุดูุฏ API route header ูุง ุฏุฑุณุช ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```typescript
headers: {
  "Content-Type": "text/event-stream",
  "Cache-Control": "no-cache",
}
```

2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู `ReadableStream` ุจู ุฏุฑุณุช ุงุฌุงุฏ ูโุดูุฏ

### ูุดฺฉู: ุฌุฏุงูู ุฎูุจ ููุงุด ุฏุงุฏู ููโุดููุฏ

**ุฑุงูโุญู:**
ูุทูุฆู ุดูุฏ `remarkGfm` ุงุถุงูู ุดุฏู:
```typescript
<ReactMarkdown remarkPlugins={[remarkGfm]}>
```

### ูุดฺฉู: Syntax highlighting ฺฉุงุฑ ููโฺฉูุฏ

**ุฑุงูโุญู:**
1. ุงุณุชุงู highlight.js ุฑุง import ฺฉูุฏ ุฏุฑ `globals.css`:
```css
@import "highlight.js/styles/github-dark.css";
```

2. ูุทูุฆู ุดูุฏ `rehypeHighlight` ุงุถุงูู ุดุฏู:
```typescript
<ReactMarkdown rehypePlugins={[rehypeHighlight]}>
```

---

## ๐ ุฌุฑุงู ฺฉุงุฑ (Workflow)

```
1. ฺฉุงุฑุจุฑ ุณูุงู ูโูพุฑุณุฏ
   โ
2. useChat.sendMessage() ูุฑุงุฎูุงู ูโุดูุฏ
   โ
3. ุฏุฑุฎูุงุณุช ุจู /api/ai-chat ุงุฑุณุงู ูโุดูุฏ
   โ
4. API route ุณุฑูุณ OpenAI ุฑุง ุตุฏุง ูโุฒูุฏ
   โ
5. sendChatToOpenAIStream() ฺฉ ReadableStream ุจุฑูโฺฏุฑุฏุงูุฏ
   โ
6. Stream ุจู client ุงุฑุณุงู ูโุดูุฏ
   โ
7. useChat ูุญุชูุง ุฑุง chunk ุจู chunk ุฏุฑุงูุช ูโฺฉูุฏ
   โ
8. updateMessageContent() ูพุงู ุฑุง ุจูโุฑูุฒ ูโฺฉูุฏ
   โ
9. ChatMessages Markdown ุฑุง render ูโฺฉูุฏ
   โ
10. ฺฉุงุฑุจุฑ ูพุงุณุฎ ุฒุจุง ุจุง ูุฑูุช ุฑุง ูโุจูุฏ โจ
```

---

## ๐ง ูฺฉุงุช ุชูุณุนู

### ุงูุฒูุฏู Markdown Component ุณูุงุฑุด

```typescript
<ReactMarkdown
  components={{
    // ฺฉุงููพูููุช ุณูุงุฑุด ุจุฑุง warning box
    warning: ({ node, ...props }) => (
      <div className="bg-yellow-100 border-l-4 border-yellow-500 p-4">
        <p className="font-bold">โ๏ธ ูุดุฏุงุฑ</p>
        <div {...props} />
      </div>
    ),
  }}
>
```

### ุงูุฒูุฏู Animation ุจู Streaming

```typescript
// ุฏุฑ ChatMessages.tsx
const { displayText, isComplete } = useTypewriter(
  !isUser ? content : content,
  !isUser ? 30 : 0 // ุณุฑุนุช ุชุงูพ (ms)
);

// ูุดุงูฺฏุฑ ุชุงูพ ุฏุฑ ุญุงู ุงูุฌุงู
{!isUser && !isComplete && (
  <span className="inline-block w-2 h-4 bg-indigo-500 ml-1 animate-pulse"></span>
)}
```

---

## ๐ ฺฺฉโูุณุช ุชุณุช

- [ ] ูุนูู ูโุชูุงูุฏ ุณูุงู ุจูพุฑุณุฏ ู ูพุงุณุฎ markdown ุฏุฑุงูุช ฺฉูุฏ
- [ ] ุฏุงูุดโุขููุฒ ูโุชูุงูุฏ ุณูุงู ุจูพุฑุณุฏ ู ูพุงุณุฎ markdown ุฏุฑุงูุช ฺฉูุฏ
- [ ] ูุงูุฏ ูโุชูุงูุฏ ุณูุงู ุจูพุฑุณุฏ ู ูพุงุณุฎ markdown ุฏุฑุงูุช ฺฉูุฏ
- [ ] ูุฏุฑ ูโุชูุงูุฏ ุณูุงู ุจูพุฑุณุฏ ู ูพุงุณุฎ markdown ุฏุฑุงูุช ฺฉูุฏ
- [ ] ุฌุฏุงูู ุจู ุฏุฑุณุช ููุงุด ุฏุงุฏู ูโุดููุฏ
- [ ] ุนูุงูู ุจุง ุงุณุชุงู ููุงุณุจ ููุงุด ุฏุงุฏู ูโุดููุฏ
- [ ] ฺฉุฏูุง ุจุง syntax highlighting ููุงุด ุฏุงุฏู ูโุดููุฏ
- [ ] ูุณุชโูุง ุจู ุฏุฑุณุช render ูโุดููุฏ
- [ ] ููู ูููโูุง ุจุง ุงุณุชุงู ููุงุณุจ ููุงุด ุฏุงุฏู ูโุดููุฏ
- [ ] Streaming ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ (ฺฉููู ุจู ฺฉููู)
- [ ] ุฏฺฉูู ุชููู ุชููุฏ ูพุงุณุฎ ฺฉุงุฑ ูโฺฉูุฏ
- [ ] ูพุงูโูุง ุฏุฑ localStorage ุฐุฎุฑู ูโุดููุฏ
- [ ] ุชุงุฑุฎฺู ฺุชโูุง ูฺฏูุฏุงุฑ ูโุดูุฏ

---

**ุชุงุฑุฎ ุงุฌุงุฏ:** 2025-12-08
**ูุณุฎู:** 1.0.0
**ูุถุนุช:** โ ฺฉุงูู ู ุขูุงุฏู ุงุณุชูุงุฏู
